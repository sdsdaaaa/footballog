<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Footballog - í˜ì´ì§€ ì œëª©</title>
  <link rel="stylesheet" href="css/style.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="js/script.js" defer></script>

  <!-- Firebase ì¸ì¦ ì„¤ì • -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
   import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
import {
  getFirestore,         // Firestore ì´ˆê¸°í™”
  collection,           // ì»¬ë ‰ì…˜ ì°¸ì¡°
  doc,                  // íŠ¹ì • ë¬¸ì„œ ì°¸ì¡°
  getDoc,               // ë¬¸ì„œ 1ê°œ ì½ê¸°
  getDocs,              // ì¿¼ë¦¬ ê²°ê³¼ ì—¬ëŸ¬ ë¬¸ì„œ ì½ê¸°
  setDoc,               // ë¬¸ì„œ ì „ì²´ ë®ì–´ì“°ê¸°
  addDoc,               // ë¬¸ì„œ ìë™ IDë¡œ ì¶”ê°€
  updateDoc,            // ë¬¸ì„œ í•„ë“œ ì¼ë¶€ ìˆ˜ì •
  deleteDoc,            // ë¬¸ì„œ ì‚­ì œ
  query,                // ì¡°ê±´ ì¿¼ë¦¬ êµ¬ì„±
  where,                // í•„í„° ì¡°ê±´
  orderBy,              // ì •ë ¬ ì¡°ê±´
  limit,                // ì œí•œ
  startAfter,           // í˜ì´ì§€ë„¤ì´ì…˜
  onSnapshot            // ì‹¤ì‹œê°„ ë³€ê²½ ê°ì§€ (listener)
} from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA02saQDvqMQbDLrD5UMwX848E6eFO-rUU",
      authDomain: "northern-cooler-461505-d5.firebaseapp.com",
      projectId: "northern-cooler-461505-d5",
      storageBucket: "northern-cooler-461505-d5.appspot.com",
      messagingSenderId: "57199546606",
      appId: "1:57199546606:web:b4e134094c86623e25a3ff",
      measurementId: "G-562VJ9VE2P"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    window.addEventListener("DOMContentLoaded", () => {
  const loginBtn = document.querySelector(".login-btn");
  const mypageBtn = document.getElementById("mypageBtn");
  const alarmBtn = document.getElementById("alarmBtn");
  const alarmList = document.getElementById("alarmList");
  const alarmDot = document.getElementById("alarmDot");


  if (alarmBtn) {
  alarmBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  const isVisible = alarmList.style.display === "block";

  if (!isVisible && alarmList.innerHTML.trim() === "") {
    alarmList.innerHTML = `<div style='padding:10px; color:#999; text-align:center;'>ìƒˆë¡œìš´ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
  }

  // âœ… ì•Œë¦¼ì°½ì„ ì—´ ë•Œ ë¹¨ê°„ ì  ìˆ¨ê¸°ê¸°
  if (!isVisible) {
    alarmDot.style.display = "none";
  }

  alarmList.style.display = isVisible ? "none" : "block";
});

}

document.addEventListener("click", (e) => {
  if (!alarmBtn.contains(e.target) && !alarmList.contains(e.target)) {
    alarmList.style.display = "none";
  }
});


  onAuthStateChanged(auth, async (user) => {
  if (user) {
    loginBtn.textContent = "ë¡œê·¸ì•„ì›ƒ";
    loginBtn.href = "#";
    loginBtn.onclick = () => {
      signOut(auth).then(() => {
        alert("ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.");
        location.reload();
      });
    };
    if (mypageBtn) mypageBtn.style.display = "inline-block";

    const db = getFirestore();
    const userDocRef = doc(db, "users", user.uid);
    const userSnap = await getDoc(userDocRef);
    if (!userSnap.exists()) return;

    const currentUserNickname = userSnap.data().nickname;

    const welcomeBox = document.getElementById("welcome-message");
    if (welcomeBox) {
      welcomeBox.textContent = `í™˜ì˜í•©ë‹ˆë‹¤, ${currentUserNickname}ë‹˜`;
      welcomeBox.style.display = "block";
    }

    // âœ… ì•Œë¦¼ ê°ì§€ (messages ì½œë ‰ì…˜, ë‹‰ë„¤ì„ ê¸°ì¤€)
    const messagesRef = collection(db, "messages");
    const q = query(
      messagesRef,
      where("to", "==", currentUserNickname),
      orderBy("timestamp", "desc")
    );

    onSnapshot(q, (snapshot) => {
      const unread = [];
      snapshot.forEach((doc) => {
        const data = doc.data();
        if (!data.read) unread.push({ id: doc.id, ...data });
      });

      if (unread.length > 0) {
        alarmDot.style.display = "block";
        alarmList.innerHTML = "";

        const senders = new Set();
        unread.forEach((msg) => {
          if (!senders.has(msg.from)) {
            senders.add(msg.from);

            const div = document.createElement("div");
            div.style.padding = "10px";
            div.style.borderBottom = "1px solid #eee";
            div.style.cursor = "pointer";

            const content =
              msg.content.length > 30 ? msg.content.slice(0, 30) + "..." : msg.content;

            div.textContent = `${msg.from} â–¶ ${content}`;
            div.onclick = async () => {
              const q2 = query(
                collection(db, "messages"),
                where("from", "==", msg.from),
                where("to", "==", currentUserNickname),
                where("read", "==", false)
              );
              const snap = await getDocs(q2);

              div.remove();

              const updatePromises = [];
              snap.forEach((doc) => {
                updatePromises.push(updateDoc(doc.ref, { read: true }));
              });
              await Promise.all(updatePromises);

              const winName = `chat_with_${msg.from}`;
              const url = `/pages/send-message.html?to=${encodeURIComponent(msg.from)}`;
              const features = "width=500,height=600,resizable=yes,scrollbars=yes";
              window.open(url, winName, features);

              if (alarmList.children.length === 0) {
                alarmList.innerHTML = "<div style='padding:10px;'>ìƒˆë¡œìš´ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
              }

              const now = new Date();
              await setDoc(
                doc(db, "users", currentUserNickname, "recentReads", msg.from),
                { lastRead: now }
              );
            };

            alarmList.appendChild(div);
          }
        });
      } else {
        alarmDot.style.display = "none";
        alarmList.innerHTML = "<div style='padding:10px;'>ìƒˆë¡œìš´ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>";
      }
    });
  } else {
    loginBtn.textContent = "ë¡œê·¸ì¸";
    loginBtn.href = "login.html";
    if (mypageBtn) mypageBtn.style.display = "none";
  }
});

});

  </script>





<style>

#ranking-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 15px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 0 12px rgba(0,0,0,0.06);
}

#ranking-table thead {
  background-color: #e3f2fd;
}

#ranking-table th, #ranking-table td {
  padding: 12px 10px;
  text-align: center;
  border-bottom: 1px solid #eee;
}

#ranking-table tbody tr:hover {
  background-color: #f0f8ff;
  font-weight: 600;
  transition: background-color 0.2s ease;
}

#ranking-table td:first-child {
  font-weight: 700;
  color: #1565c0;
}

.team-cell {
  display: flex;
  align-items: center;
  gap: 10px;
  justify-content: flex-start; /* âœ… ì—¬ê¸°ë§Œ ë³€ê²½ë¨ */
  padding-left: 8px;
}

.team-cell img {
  width: 24px;
  height: 24px;
  border-radius: 4px;
  border: 1px solid #ccc;
}
.team-link {
  text-decoration: none;       /* âŒ ë°‘ì¤„ ì œê±° */
  color: inherit;              /* ê¸°ë³¸ ìƒ‰ìƒ ìƒì† */
  font-weight: 600;
  cursor: pointer;
  transition: color 0.2s ease;
}

.team-link:hover {
  color: #1565c0;              /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œë§Œ ìƒ‰ìƒ ë³€í™” */
}



</style>


</head>

<body>
  <!-- ê³ ì • ê°ì§€ ì„¼ì„œ -->
  <div id="taskbar-sensor" style="position: fixed; top: 0; left: 0; width: 5px; height: 100vh; z-index: 10000;"></div>

    <!-- ìƒë‹¨ë°” -->
  <header>
    <div class="left-section">
      <div class="logo">FOOTBALLOG</div>
      <input class="search" placeholder="ê²€ìƒ‰ :" />
    </div>
   <div class="right-section">
  <div class="alarm-wrapper">
  <button id="alarmBtn" class="material-icon-btn">
    <span class="material-icons">notifications</span>
    <span id="alarmDot"></span>
  </button>
  <div id="alarmList"></div>
</div>

  <div class="auth-wrapper">
    <div class="auth-top">
      <a href="mypage.html" id="mypageBtn" class="mypage-btn" style="display: none;">ë§ˆì´í˜ì´ì§€</a>
      <a href="login.html" class="login-btn">ë¡œê·¸ì¸</a>
      <button class="menu-btn" onclick="toggleRightMenu()">â˜°</button>
    </div>
    <!-- ì—¬ê¸°ì— í™˜ì˜ ë©”ì‹œì§€ ì¶”ê°€ë„ ê°€ëŠ¥ -->
    <!-- <div id="welcome-message" class="tab-welcome" style="display: none;"></div> -->
  </div>
</div>

  </header>

<nav class="tab-menu">
  <div class="tab-left-spacer"></div>

  <div class="tab-center">
    <a href="home.html">í™ˆ</a>
    <a href="schedule.html">ì¼ì •</a>
    <a href="ranking.html"class="active">ìˆœìœ„</a>
    <a href="team-info.html">íŒ€ ì •ë³´</a>
  </div>

  <div id="welcome-message" class="tab-welcome" style="display: none;">
    í™˜ì˜í•©ë‹ˆë‹¤, ì‚¬ìš©ìë‹˜
  </div>
</nav>



  <!-- ë³¸ë¬¸ ì½˜í…ì¸  ì˜ì—­ -->
<main style="padding: 30px;">
  <h1 style="font-size: 26px; margin-bottom: 20px;">ğŸ† í˜„ì¬ ë¦¬ê·¸ ìˆœìœ„</h1>

  <div style="display: flex; gap: 20px; align-items: center; margin-bottom: 20px;">
    <label for="seasonSelect" style="font-weight: 600;">ì‹œì¦Œ ì„ íƒ:</label>
    <select id="seasonSelect" style="padding: 6px 10px; border-radius: 6px; border: 1.5px solid #1565c0; font-weight: 600; color: #1565c0;"></select>

    <label for="leagueSelect" style="font-weight: 600;">ë¦¬ê·¸ ì„ íƒ:</label>
    <select id="leagueSelect" style="padding: 6px 10px; border-radius: 6px; border: 1.5px solid #1565c0; font-weight: 600; color: #1565c0;"></select>
  </div>

<table id="ranking-table" style="
  width: 100%;
  border-collapse: collapse;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  border-radius: 12px;
  overflow: hidden;
  font-size: 15px;
">
  <thead>
    <tr style="background-color: #e3f2fd; color: #1565c0; font-weight: bold;">
      <th>ìˆœìœ„</th>
      <th>íŒ€</th>
      <th>ìŠ¹ì </th>
      <th>ê²½ê¸°</th>
      <th>ìŠ¹</th>
      <th>ë¬´</th>
      <th>íŒ¨</th>
      <th>ë“ì </th>
      <th>ì‹¤ì </th>
      <th>ë“ì‹¤ì°¨</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td colspan="10" style="text-align:center;">ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤...</td>
    </tr>
  </tbody>
</table>
  </main>

  <!-- ì‘ì—… í‘œì‹œì¤„ -->
  <footer id="taskbar">
    <div id="taskbar-icons"></div>
    <div class="taskbar-home">âŒ‚</div>
  </footer>

  <!-- ìš°ì¸¡ ë©”ë‰´ -->
  <div id="right-menu-panel">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h3 style="margin: 0;">ë©”ë‰´</h3>
      <button onclick="toggleRightMenu()" style="border: none; background: none; font-size: 18px; cursor: pointer;">â‰«</button>
    </div>
    <ul>
      <li onclick="handleMenuClick('football-news')">ì¶•êµ¬ ë‰´ìŠ¤</li>
      <li onclick="handleMenuClick('community')">ì»¤ë®¤ë‹ˆí‹°</li>
      <li onclick="handleMenuClick('goods-shopping')">êµ¿ì¦ˆ ì‡¼í•‘</li>
      <li onclick="handleMenuClick('match-stats')">ê²½ê¸° í†µê³„</li>
      <li onclick="handleMenuClick('match-broadcast')">ê²½ê¸° ì¤‘ê³„</li>
      <li onclick="handleMenuClick('football-video')">ì¶•êµ¬ ì˜ìƒ</li>
      <li onclick="handleMenuClick('neighbors')">ì´ì›ƒ</li>
    </ul>
  </div>

  <!-- ìš°í´ë¦­ ë©”ë‰´ -->
  <ul id="context-menu" style="display: none; position: absolute; background: white; border: 1px solid #ccc; border-radius: 5px; padding: 0; margin: 0; list-style: none; z-index: 10000;">
    <li id="ctx-close" style="padding: 8px 12px; cursor: pointer;">ë‹«ê¸°</li>
  </ul>



<script>
const seasonSelect = document.getElementById("seasonSelect");
const leagueSelect = document.getElementById("leagueSelect");
const tbody = document.querySelector("#ranking-table tbody");

const seasons = [2020, 2021, 2022, 2023, 2024, 2025];
const leagues = {
  "club_world_cup": "í´ëŸ½ì›”ë“œì»µ",
  "premier_league": "í”„ë¦¬ë¯¸ì–´ë¦¬ê·¸",
  "laliga": "ë¼ë¦¬ê°€",
  "bundesliga": "ë¶„ë°ìŠ¤ë¦¬ê°€",
  "serie_a": "ì„¸ë¦¬ì—A",
  "ligue1": "ë¦¬ê·¸1",
  "eredivisie": "ì—ë ˆë””ë¹„ì‹œ",
  "ucl": "ì±”í”¼ì–¸ìŠ¤ë¦¬ê·¸",
  "uel": "ìœ ë¡œíŒŒë¦¬ê·¸",
  "efl_cup": "EFLì»µ",
  "fa_cup": "FAì»µ",
  "copa_del_rey": "ì½”íŒŒë¸ë ˆì´"
};

// ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
seasons.forEach(season => {
  const opt = document.createElement("option");
  opt.value = season;
  opt.textContent = `${season} ì‹œì¦Œ`;
  seasonSelect.appendChild(opt);
});

for (const [key, label] of Object.entries(leagues)) {
  const opt = document.createElement("option");
  opt.value = key;
  opt.textContent = label;
  leagueSelect.appendChild(opt);
}

// ì„ íƒ ì‹œ JSON ë¡œë”©
seasonSelect.addEventListener("change", loadStandings);
leagueSelect.addEventListener("change", loadStandings);

async function loadStandings() {
  const season = seasonSelect.value;
  const league = leagueSelect.value;
  if (!season || !league) return;

  const filepath = `rankingdata/${season}/standings_${season}_${league}.json`;
  try {
    const res = await fetch(filepath);
    const data = await res.json();

    const standings = data.response?.[0]?.league?.standings?.[0];
    if (!standings) throw new Error("ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜");

    tbody.innerHTML = "";
    standings.forEach(team => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${team.rank}</td>
      <td>
  <div class="team-cell">
    <img src="${team.team.logo}" alt="${team.team.name}">
    <a href="teamdata/${team.team.name.toLowerCase().replace(/\s+/g, '').replace(/[^\w]/g, '')}.html" class="team-link">
  ${team.team.name}
</a>

  </div>
</td>

        <td>${team.points}</td>
        <td>${team.all.played}</td>
        <td>${team.all.win}</td>
        <td>${team.all.draw}</td>
        <td>${team.all.lose}</td>
        <td>${team.all.goals.for}</td>
        <td>${team.all.goals.against}</td>
        <td>${team.goalsDiff}</td>
      `;
      tbody.appendChild(row);
    });

  } catch (err) {
    console.error("JSON ë¡œë”© ì‹¤íŒ¨:", err);
    tbody.innerHTML = `<tr><td colspan="10" style="text-align:center;">í•´ë‹¹ ë°ì´í„° íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>`;
  }
}

// ê¸°ë³¸ê°’ ì„¤ì •
seasonSelect.value = "2024";
leagueSelect.value = "premier_league";
loadStandings();
</script>





</body>
</html>
