<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê¸€ì“°ê¸°</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 30px; background: #f9fafc; }
    input, textarea { width: 100%; margin-bottom: 15px; padding: 10px; font-size: 16px; }
    button { padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>ê¸€ì“°ê¸°</h1>
  <input id="title" placeholder="ì œëª© ì…ë ¥">
  <textarea id="content" placeholder="ë‚´ìš© ì…ë ¥" rows="10"></textarea>
  <button onclick="savePost()">ë“±ë¡</button>

<script type="module">
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA02saQDvqMQbDLrD5UMwX848E6eFO-rUU",
    authDomain: "northern-cooler-461505-d5.firebaseapp.com",
    projectId: "northern-cooler-461505-d5",
    storageBucket: "northern-cooler-461505-d5.appspot.com",
    messagingSenderId: "57199546606",
    appId: "1:57199546606:web:b4e134094c86623e25a3ff"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let currentUser;
  let nickname = "";

  let nicknameLoaded = false;

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    alert("ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
    location.href = "login.html";
    return;
  }

  currentUser = user;
  const userRef = doc(db, "users", currentUser.uid);
  const userSnap = await getDoc(userRef);
  nickname = userSnap.exists() ? userSnap.data().nickname : currentUser.email;
  nicknameLoaded = true; // âœ… ë¡œë”© ì™„ë£Œ í‘œì‹œ
});

window.savePost = function () {
  if (!nicknameLoaded) {
    alert("ë‹‰ë„¤ì„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
    return;
  }

  const title = document.getElementById("title").value.trim();
  const content = document.getElementById("content").value.trim();

  // ğŸ”’ ìœ íš¨ì„± ê²€ì‚¬: 1ê¸€ì ì´ìƒ ì…ë ¥ ì—¬ë¶€ í™•ì¸
  if (title.length < 1) {
    alert("ì œëª©ì„ 1ê¸€ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  if (content.length < 1) {
    alert("ë‚´ìš©ì„ 1ê¸€ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  const type = new URLSearchParams(location.search).get("type") || "free";
  const posts = JSON.parse(localStorage.getItem("posts") || "[]");

  const newPost = {
    id: String(Date.now()),
    type,
    title,
    content,
    date: new Date().toLocaleDateString(),
    author: nickname,
    views: 0,
    comments: []
  };

  posts.push(newPost);
  localStorage.setItem("posts", JSON.stringify(posts));
  alert("ë“±ë¡ ì™„ë£Œ!");
  location.href = `board.html?type=${type}`;
};

</script>

</body>
</html>
